<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>Jet X Controll Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button {
            width: 80%;
            padding: 15px;
            font-size: 18px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: none;
        }
        .stop-button {
            background-color: red;
            color: white;
        }
        .take-button {
            background-color: blue;
            color: white;
        }
        .update-button {
            background-color: green;
            color: white;
            margin-bottom: 20px;
        }
        .restart-button{
            background-color: rgb(18, 182, 100);
            color: white;
        }
        .shutdown-button{
            background-color: rgb(207, 2, 2);
            color: white;
        }
        .image-container {
            margin-bottom: 20px;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 10px;
        }
        input {
            width: 80%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h1>JetX Control Panel</h1>

    <button class="stop-button" onclick="updateMainTask()">STOP</button>
    <button class="take-button" onclick="updateSS()">TAKE SCREEN SHOT</button>

    <input type="text" id="textField1" placeholder="Enter cash value">
    <button class="update-button" onclick="updateCash()">Update Cash</button>

    <input type="text" id="textField2" placeholder="Enter odd value">
    <button class="update-button" onclick="updateOdd()">Update Odd</button>
    
    <div id="imageGallery"></div>
    <button class="restart-button" onclick="updatereStart()">RESTART</button>
    <button class="shutdown-button" onclick="shutdownPC()">SHUTDOWN PC</button>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-storage.js"></script>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyAjMTH05bxoCLRrltq31BaGsAHKQ8_aCcM",
            authDomain: "jet-x-d9e7e.firebaseapp.com",
            databaseURL: "https://jet-x-d9e7e-default-rtdb.firebaseio.com",
            projectId: "jet-x-d9e7e",
            storageBucket: "jet-x-d9e7e.appspot.com",
            messagingSenderId: "1063204966889",
            appId: "1:1063204966889:web:2f3feb77c31f72b812fb78",
            measurementId: "G-3S4GF0BTSF"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();
        var storage = firebase.storage();

       
        // Function to update "mainTask" when STOP is clicked
        function updateMainTask() {
            database.ref('test').update({
                mainTask: 1
            }).then(() => {
                let timerInterval;
                Swal.fire({
                title: "Softwer STOPED!",
                html: "",//"I will close in <b></b> milliseconds.",
                timer: 2000,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading();
                    const timer = Swal.getPopup().querySelector("b");
                    timerInterval = setInterval(() => {
                    timer.textContent = `${Swal.getTimerLeft()}`;
                    }, 100);
                },
                willClose: () => {
                    clearInterval(timerInterval);
                }
                }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {
                    console.log("I was closed by the timer");
                }
                });
            }).catch((error) => {
                alert("Error: " + error.message);
            });
        }

        // Function to update "SS" when TAKE is clicked and recall listImages after 5 seconds
        function updateSS() {
            database.ref('test').update({
                SS: 1
                
            }).then(() => {
                let timerInterval;
                Swal.fire({
                title: "Screen Shot Uplading!",
                html: "Image will apear in <b></b> milliseconds.",
                timer: 2000,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading();
                    const timer = Swal.getPopup().querySelector("b");
                    timerInterval = setInterval(() => {
                    timer.textContent = `${Swal.getTimerLeft()}`;
                    }, 100);
                },
                willClose: () => {
                    clearInterval(timerInterval);
                    listImages();
                }
                }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {
                    console.log("I was closed by the timer");
                }
                });
                // Delay for 5 seconds before recalling listImages()
                       /* setTimeout(() => {
                            listImages(); // Automatically call the function after 5 seconds
                        }, 4000); // 5000 milliseconds = 5 seconds*/
            }).catch((error) => {
                alert("Error: " + error.message);
            });
        }

        // Function to update "cash" with the value from textField1
        function updateCash() {
            var cashValue = parseFloat(document.getElementById('textField1').value);
            if (!isNaN(cashValue)) {
                database.ref('test').update({
                    cash: cashValue
                }).then(() => {
                    let timerInterval;
                    Swal.fire({
                    title: "Cash Updated ! amount : " + cashValue,
                    html: "",//"I will close in <b></b> milliseconds.",
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading();
                        const timer = Swal.getPopup().querySelector("b");
                        timerInterval = setInterval(() => {
                        timer.textContent = `${Swal.getTimerLeft()}`;
                        }, 100);
                    },
                    willClose: () => {
                        clearInterval(timerInterval);
                    }
                    }).then((result) => {
                    /* Read more about handling dismissals below */
                    if (result.dismiss === Swal.DismissReason.timer) {
                        console.log("I was closed by the timer");
                    }
                    });
                }).catch((error) => {
                    alert("Error: " + error.message);
                });
            } else {
                alert("Please enter a valid number for cash.");
            }
        }

        // Function to update "odd" with the value from textField2
        function updateOdd() {
            var oddValue = parseFloat(document.getElementById('textField2').value);
            if (!isNaN(oddValue)) {
                database.ref('test').update({
                    odd: oddValue
                }).then(() => {
                    let timerInterval;
                Swal.fire({
                title: "Odd Updated to : " + oddValue,
                html: "",//"I will close in <b></b> milliseconds.",
                timer: 2000,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading();
                    const timer = Swal.getPopup().querySelector("b");
                    timerInterval = setInterval(() => {
                    timer.textContent = `${Swal.getTimerLeft()}`;
                    }, 100);
                },
                willClose: () => {
                    clearInterval(timerInterval);
                }
                }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {
                    console.log("I was closed by the timer");
                }
                });
                }).catch((error) => {
                    alert("Error: " + error.message);
                });
            } else {
                alert("Please enter a valid number for odd.");
            }
        }

        // Function to list all images in the /screenshots folder
        function listImages() {
            var storageRef = storage.ref('screenshots');
            var imageGallery = document.getElementById('imageGallery');
            imageGallery.innerHTML = ''; // Clear the gallery before loading new data

            // List all files in the /screenshots folder
            storageRef.listAll().then(function(result) {
                result.items.forEach(function(imageRef) {
                    displayImage(imageRef);
                });
            }).catch(function(error) {
                console.error("Error listing images: ", error);
            });
        }

        // Function to display each image and its delete button
        function displayImage(imageRef) {
            imageRef.getDownloadURL().then(function(url) {
                // Create a container for the image and delete button
                var imageContainer = document.createElement('div');
                imageContainer.classList.add('image-container');

                // Create an image element
                var img = document.createElement('img');
                img.src = url;

                // Create a delete button
                var deleteButton = document.createElement('button');
                deleteButton.textContent = "Delete";
                deleteButton.onclick = function() {
                    deleteImage(imageRef);
                };

                // Append the image and button to the container
                imageContainer.appendChild(img);
                imageContainer.appendChild(deleteButton);

                // Append the container to the gallery
                document.getElementById('imageGallery').appendChild(imageContainer);
            }).catch(function(error) {
                console.error("Error getting image URL: ", error);
            });
        }

        // Function to delete an image
        function deleteImage(imageRef) {
            imageRef.delete().then(function() {
                alert("Image deleted successfully!");
                listImages(); // Refresh the image list after deletion
            }).catch(function(error) {
                alert("Error deleting image: " + error.message);
            });
        }

        function updatereStart(){
            database.ref('test').update({
                restart:1
            }).then(() => {
                let timerInterval;
                Swal.fire({
                title: "Process Restart Successfylly!!",
                html: "",
                timer: 2000,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading();
                    const timer = Swal.getPopup().querySelector("b");
                    timerInterval = setInterval(() => {
                    timer.textContent = `${Swal.getTimerLeft()}`;
                    }, 100);
                },
                willClose: () => {
                    clearInterval(timerInterval);
                    listImages();
                }
                }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {
                    console.log("I was closed by the timer");
                }
                });
            }).catch((error) => {
                alert("Error: " + error.message);
            });
        }

        function shutdownPC() {
            // Show the SweetAlert confirmation dialog
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, shut it down!"
            }).then((result) => {
                // If the user confirms, perform the shutdown update in Firebase
                if (result.isConfirmed) {
                    // Update the Firebase database with shutdown = 1
                    database.ref('test').update({
                        shutdown: 1
                    }).then(() => {
                        // Show success message after the shutdown is triggered
                        Swal.fire({
                            title: "Shutdown Initiated!",
                            text: "The system will shut down shortly.",
                            icon: "success"
                        });
                    }).catch((error) => {
                        // Handle any errors with Firebase update
                        Swal.fire({
                            title: "Error!",
                            text: "Failed to initiate shutdown: " + error.message,
                            icon: "error"
                        });
                    });
                }
            });
        }

        // Load images when the page loads
        window.onload = function() {
            listImages();
        };
    </script>

</body>
</html>
